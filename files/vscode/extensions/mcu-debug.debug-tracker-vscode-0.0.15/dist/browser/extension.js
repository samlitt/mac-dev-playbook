/*! For license information please see extension.js.LICENSE.txt */
(()=>{"use strict";var e={846:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebugTrackerFactory=t.DebuggerTracker=void 0;const r=n(655).__importStar(n(496)),s=n(479);class i{constructor(e,t){this.clientId=e,this.handler=t}}let o="unknown extension name";const a={},c={},u={};class l{constructor(e){this.session=e,this.isTerminated=!1,this.status=s.DebugSessionStatus.Unknown,u[e.id]=this,l.setStatus(e,s.DebugSessionStatus.Initializing)}static getSessionById(e){return u[e]}onDidSendMessage(e){if(this.isTerminated)return;d.dbgLevel>1&&f("--\x3e ",e);const t=e;if(t)switch(t.type){case"event":{const e=t;if(e){if("stopped"===e.event)return this.fistStackTrace=void 0,void l.setStatus(this.session,s.DebugSessionStatus.Stopped,e);if("continued"===e.event)return void l.setStatus(this.session,s.DebugSessionStatus.Running);if("capabilities"===e.event){const t=e.body?.capabilities;return void(t&&l.sendCapabilities(this.session,t))}}const n={clientId:"",event:s.OtherDebugEvents.ProtocolEvent,sessionId:this.session.id,protocolEvent:e};l.notifyEventClients(this.session.type,n);break}case"response":{const e=t;if(e){if(!e.success&&["initialize","launch","attach"].find((t=>t===e.command))){this.terminate();break}const t=["continue","reverseContinue","step","stepIn","stepOut","stepBack","next","goto"];if(e.success&&"stackTrace"===e.command)e.body?.stackFrames&&e.body.stackFrames.length>0&&void 0===this.fistStackTrace&&(this.fistStackTrace=e,l.sendFirstStackTrace(this.session,this.fistStackTrace));else if(e.success&&t.includes(e.command))l.setStatus(this.session,s.DebugSessionStatus.Running);else if("initialize"===e.command){const t=e.body;t&&l.sendCapabilities(this.session,t)}}break}}}onWillReceiveMessage(e){d.dbgLevel>1&&f("<-- ",e),this.isTerminated}static trackAllSessions(){return[r.debug.onDidStartDebugSession((e=>{l.setStatus(e,s.DebugSessionStatus.Started)})),r.debug.onDidTerminateDebugSession((e=>{const t=u[e.id];t&&t.terminate()}))]}terminate(){this.isTerminated||(this.isTerminated=!0,l.setStatus(this.session,s.DebugSessionStatus.Terminated),delete u[this.session.id])}static notifyClientsGeneric(e,t){for(const n of t){const t={...e,clientId:n.clientId};try{n.handler(t).catch((e=>{console.error(`debug-tracer: Client handler threw an exception, ${e}`,t)}))}catch(e){console.error(`debug-tracer: Could not run client handler, ${e}`,t)}}}static notifyClients(e,t){const n=a["*"]||[],r=a[e]||[],s=n.concat(r);l.notifyClientsGeneric(t,s)}static notifyEventClients(e,t){const n=c["*"]||[],r=c[e]||[],s=n.concat(r);l.notifyClientsGeneric(t,s)}static setStatus(e,t,n){d.dbgLevel&&f(`${o}: Session '${e.type}:${e.name}': Status '${t}', id = ${e.id}`,void 0);const r=u[e.id];if(r&&r.status!==t){r.status=t;const i={clientId:"",event:t,sessionId:e.id};t===s.DebugSessionStatus.Initializing?i.session=e:t===s.DebugSessionStatus.Stopped&&(i.stoppedEvent=n),this.notifyClients(e.type,i)}}static sendCapabilities(e,t){d.dbgLevel&&f(`${o}: Session '${e.type}:${e.name}': event '${s.OtherDebugEvents.Capabilities}', id = ${e.id}`,void 0);const n={clientId:"",event:s.OtherDebugEvents.Capabilities,sessionId:e.id,capabilities:t};this.notifyClients(e.type,n)}static sendFirstStackTrace(e,t){d.dbgLevel&&f(`${o}: Session '${e.type}:${e.name}': event '${s.OtherDebugEvents.FirstStackTrace}', id = ${e.id}`,void 0);const n={clientId:"",event:s.OtherDebugEvents.FirstStackTrace,sessionId:e.id,stackTrace:t};this.notifyClients(e.type,n)}notifyCurrentStatus(e){const t={clientId:e,event:this.status,sessionId:this.session.id,session:this.session};l.notifyClients(this.session.type,t)}}t.DebuggerTracker=l;class d{static register(e,t,n){t&&(d.dbgChannel=t),void 0!==n&&(d.dbgLevel=n),d.context=e;const r=e.extensionUri.path.split(/[\\/]+/);return o=r.pop()||e.extensionUri.path,new d}constructor(){d.context.subscriptions.push(...l.trackAllSessions(),r.workspace.onDidChangeConfiguration(this.settingsChanged.bind(this)),r.debug.registerDebugAdapterTrackerFactory("*",this))}settingsChanged(e){console.log(e)}createDebugAdapterTracker(e){return new l(e)}static getNonce(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<32;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}subscribe(e){const t=d.getNonce(),n=new i(t,e.body.handler),r=r=>{let s=a[r];s?s.push(n):a[r]=[n],e.body.wantCurrentStatus&&setImmediate((()=>{for(const[e,n]of Object.entries(u))n.notifyCurrentStatus(t),"*"!==r&&r!==n.session.type||n.notifyCurrentStatus(t)})),e.body.notifyAllEvents&&(s=c[r],s?s.push(n):c[r]=[n])};if(!e.body)return"Body field missing for debug-tracker subscribe()";if(!e.body.debuggers)return"No debuggers specified in debug-tracker subscribe()";if(!e.body.handler)return"No handler specified in debug-tracker subscribe()";if("function"!=typeof e.body.handler)return"Invalid handler, must be a function in debug-tracker subscribe()";if("*"===e.body.debuggers)r("*");else for(const t of e.body.debuggers)r(t);return void 0!==e.body.debugLevel&&e.body.debugLevel>d.dbgLevel&&(d.dbgLevel=e.body.debugLevel),{clientId:t}}unsubscribe(e){for(const t of[a,c])for(const n of Object.getOwnPropertyNames(t)){const r=t[n];t[n]=r.filter((t=>t.clientId!==e)),0===t[n].length&&delete t[n]}}getSessionStatus(e){const t=l.getSessionById(e);return t?t.status:s.DebugSessionStatus.Unknown}getSessionInfo(e){const t=l.getSessionById(e);if(t)return{session:t.session,status:t.status}}}function f(e,t){if(d.dbgChannel&&d.dbgLevel>0){e+=t?JSON.stringify(t):"";try{d.dbgChannel.appendLine(e)}catch(e){console.error(e?e.toString():"unknown exception?")}}}t.DebugTrackerFactory=d,d.dbgLevel=0},479:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebugTracker=t.OtherDebugEvents=t.DebugSessionStatus=t.TRACKER_EXT_ID=void 0;const r=n(655).__importStar(n(496)),s=n(846);var i,o;t.TRACKER_EXT_ID="mcu-debug.debug-tracker-vscode",(o=t.DebugSessionStatus||(t.DebugSessionStatus={})).Unknown="unknown",o.Initializing="initializing",o.Started="started",o.Stopped="stopped",o.Running="running",o.Terminated="terminated",(i=t.OtherDebugEvents||(t.OtherDebugEvents={})).FirstStackTrace="first-stack-trace",i.Capabilities="capabilities",i.ProtocolEvent="protocol-event",t.DebugTracker=class{constructor(e,t,n){this.context=e,this.tracker=s.DebugTrackerFactory.register(e,t,n)}subscribe(e){return 1!==e.version?`Unknown version ${e.version} for debug-tracker`:this.tracker.subscribe(e)}unsubscribe(e){this.tracker.unsubscribe(e)}getSessionStatus(e){return this.tracker.getSessionStatus(e)}getSessionInfo(e){return this.tracker.getSessionInfo(e)}setDbgChannel(e,t){s.DebugTrackerFactory.dbgChannel=e,s.DebugTrackerFactory.dbgLevel=t}static getTrackerExtension(e,n=1e4){let s;return new Promise((async i=>{let o=r.extensions.getExtension(t.TRACKER_EXT_ID);const a=()=>{o?o.activate().then((e=>{s=e,i(e)})):i(new Error("Internal Error: invalid call to activate"))};if(o)a();else{const c=`Install ${t.TRACKER_EXT_ID}`;if(await r.window.showErrorMessage(`${e} requires extension '${t.TRACKER_EXT_ID}' to be installed. Do you want to install '${t.TRACKER_EXT_ID}'`,c,"Cancel")!==c)return void i(new Error(`Install of extension ${t.TRACKER_EXT_ID} cancelled`));for(await r.commands.executeCommand("workbench.extensions.installExtension",t.TRACKER_EXT_ID),o=r.extensions.getExtension(t.TRACKER_EXT_ID);!o&&!s;){if(n<=0)return void i(new Error(`Install of extension ${t.TRACKER_EXT_ID} timed out`));const e=500;await new Promise((t=>{setTimeout((()=>{n-=e,t()}),e)})),o=r.extensions.getExtension(t.TRACKER_EXT_ID)}a()}}))}}},655:(e,t,n)=>{n.r(t),n.d(t,{__assign:()=>i,__asyncDelegator:()=>m,__asyncGenerator:()=>S,__asyncValues:()=>_,__await:()=>y,__awaiter:()=>l,__classPrivateFieldGet:()=>D,__classPrivateFieldSet:()=>C,__createBinding:()=>f,__decorate:()=>a,__exportStar:()=>b,__extends:()=>s,__generator:()=>d,__importDefault:()=>T,__importStar:()=>w,__makeTemplateObject:()=>k,__metadata:()=>u,__param:()=>c,__read:()=>h,__rest:()=>o,__spread:()=>p,__spreadArrays:()=>v,__values:()=>g});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)};function s(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},i.apply(this,arguments)};function o(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n}function a(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o}function c(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))}function d(e,t){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function f(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}function b(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||(t[n]=e[n])}function g(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o}function p(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(h(arguments[t]));return e}function v(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),s=0;for(t=0;t<n;t++)for(var i=arguments[t],o=0,a=i.length;o<a;o++,s++)r[s]=i[o];return r}function y(e){return this instanceof y?(this.v=e,this):new y(e)}function S(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,s=n.apply(e,t||[]),i=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){s[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=s[e](t)).value instanceof y?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function m(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,s){t[r]=e[r]?function(t){return(n=!n)?{value:y(e[r](t)),done:"return"===r}:s?s(t):t}:s}}function _(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=g(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,s){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,s,(t=e[n](t)).done,t.value)}))}}}function k(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function w(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function T(e){return e&&e.__esModule?e:{default:e}}function D(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function C(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}},496:e=>{e.exports=require("vscode")}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=e.DebugTrackerExtension=void 0;const t=n(655).__importStar(n(496)),s=n(846),i=n(479);class o extends i.DebugTracker{constructor(e,n){super(e,n),this.channel=n,this.section="mcu-debug.debug-tracker-vscode",this.debugLevel="debugLevel",this.debugLevelStrings=["0 - Disable debug logging","1 - Status changes and important events only","2 - Very verbose and includes all transactions"],this.fromSettings(),e.subscriptions.push(t.commands.registerCommand("mcu-debug.debug-tracker-vscode.start",(()=>{t.window.showInformationMessage("debug-tracker-vscode.start activated via command")})),t.workspace.onDidChangeConfiguration(this.settingsChanged.bind(this)),t.commands.registerCommand("mcu-debug.debug-tracker-vscode.debugLevel",(()=>{t.window.showQuickPick(this.debugLevelStrings,{title:"Select logging level",canPickMany:!1}).then((e=>{const n=s.DebugTrackerFactory.dbgLevel;this.setDebugLevel(e),n!==s.DebugTrackerFactory.dbgLevel&&t.workspace.getConfiguration(this.section).update(this.debugLevel,s.DebugTrackerFactory.dbgLevel)}))})))}setDebugLevel(e){if(e){const t=s.DebugTrackerFactory.dbgLevel,n=parseInt(e);if(t!==n){switch(n){case 0:s.DebugTrackerFactory.dbgLevel=0;break;case 1:s.DebugTrackerFactory.dbgLevel=1;break;case 2:s.DebugTrackerFactory.dbgLevel=2;break;default:return}this.channel&&this.channel.appendLine("Setting log level to "+this.debugLevelStrings[s.DebugTrackerFactory.dbgLevel])}}}settingsChanged(e){e.affectsConfiguration(this.section+"."+this.debugLevel)&&this.fromSettings()}fromSettings(){const e=t.workspace.getConfiguration(this.section).get(this.debugLevel,0);this.setDebugLevel(e.toString())}}e.DebugTrackerExtension=o,e.activate=function(e){let n;try{n=t.window.createOutputChannel("Mcu-debug Tracker"),n.appendLine(`This channel was created by the extension ${e.extension.id} for debugging the tracker. Default logging level is 0 (none)`),n.appendLine('You can set the logging level using the Command Palette, look for "Debug Tracker: Set debug log level". There is also an extension setting')}finally{}return new o(e,n)},e.deactivate=function(){}})(),module.exports=r})();